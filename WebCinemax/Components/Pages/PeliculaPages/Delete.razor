@page "/peliculas/delete/{IdPelicula:int}"
@using WebCinemax.Models
@using WebCinemax.Services
@inject PeliculaService PeliculaService
@inject NavigationManager NavigationManager

<PageTitle>Eliminar Película</PageTitle>

<h1>Eliminar Película</h1>

<p>¿Seguro que deseas eliminar esta película?</p>

@if (pelicula is null)
{
    <p><em>Cargando...</em></p>
}
else
{
    <div>
        <dl class="row">
            <dt class="col-sm-2">Título</dt>
            <dd class="col-sm-10">@pelicula.Titulo</dd>

            <dt class="col-sm-2">Género</dt>
            <dd class="col-sm-10">@pelicula.Genero</dd>

            <dt class="col-sm-2">Clasificación</dt>
            <dd class="col-sm-10">@pelicula.Clasificacion</dd>

            <dt class="col-sm-2">Duración</dt>
            <dd class="col-sm-10">@pelicula.DuracionMinutos minutos</dd>

            <dt class="col-sm-2">Idioma</dt>
            <dd class="col-sm-10">@pelicula.Idioma</dd>

            <dt class="col-sm-2">Poster</dt>
            <dd class="col-sm-10"><img src="@pelicula.PosterUrl" alt="@pelicula.Titulo" width="120" /></dd>
        </dl>

        <EditForm Model="pelicula" OnValidSubmit="DeletePelicula">
            <button type="submit" class="btn btn-danger">Eliminar</button> |
            <a class="btn btn-secondary" href="/peliculas">Cancelar</a>
        </EditForm>
    </div>
}

@code {
    [Parameter]
    public int IdPelicula { get; set; }

    private Pelicula? pelicula;

    protected override async Task OnInitializedAsync()
    {
        pelicula = await PeliculaService.GetByIdAsync(IdPelicula);

        if (pelicula is null)
        {
            NavigationManager.NavigateTo("/notfound");
        }
    }

    private async Task DeletePelicula()
    {
        await PeliculaService.DeleteAsync(IdPelicula);
        NavigationManager.NavigateTo("/peliculas");
    }
}